CREATE SCHEMA `cafems` ;

BEGIN;

SET FOREIGN_KEY_CHECKS = 0;
DROP TABLE IF EXISTS EMPLOYEE;
DROP TABLE IF EXISTS PROFILE;
DROP TABLE IF EXISTS WORKSLOTS;
DROP TABLE IF EXISTS BIDS;
SET FOREIGN_KEY_CHECKS = 1;

CREATE TABLE EMPLOYEE(
EMP_ID 		int NOT NULL AUTO_INCREMENT,
EMP_NAME	varchar(25) NOT NULL,
EMP_SALARY 	double NOT NULL,
EMP_DATEJOINED	varchar(25) NOT NULL,
EMP_ROLEID 	int NOT NULL,
EMP_USERNAME	varchar(25) UNIQUE,
EMP_PASSWORD 	varchar(255) NOT NULL,
EMP_POSITION	varchar(25),

PRIMARY KEY (EMP_ID)
) ENGINE = INNODB;

CREATE TABLE PROFILE(
PROFILE_ID 	int NOT NULL AUTO_INCREMENT,
PROFILE_NAME 	varchar(25) NOT NULL UNIQUE,

PRIMARY KEY (PROFILE_ID)
) ENGINE = INNODB;

CREATE TABLE WORKSLOTS(
SLOT_ID		int NOT NULL AUTO_INCREMENT,
SLOT_DATE	varchar(25) NOT NULL,
SLOT_HOURS	int NOT NULL,
SLOT_POSITION	varchar(25) NOT NULL,
SLOT_ASSIGNEDTO	int,

PRIMARY KEY(SLOT_ID))
ENGINE = INNODB;

CREATE TABLE BIDS(
BID_ID		int NOT NULL AUTO_INCREMENT,
SLOT_ID		int NOT NULL,
EMP_ID		int NOT NULL,

PRIMARY KEY(BID_ID))
ENGINE = INNODB;

ALTER TABLE EMPLOYEE ADD FOREIGN KEY (EMP_ROLEID) REFERENCES PROFILE(PROFILE_ID);
ALTER TABLE EMPLOYEE AUTO_INCREMENT=10001;

ALTER TABLE WORKSLOTS ADD FOREIGN KEY (SLOT_ASSIGNEDTO) REFERENCES EMPLOYEE(EMP_ID);

ALTER TABLE BIDS ADD FOREIGN KEY (SLOT_ID) REFERENCES WORKSLOTS(SLOT_ID);
ALTER TABLE BIDS ADD FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE(EMP_ID);

COMMIT;

insert into profile (profile_name) values("default");
insert into profile (profile_name) values("System Admin");
insert into profile (profile_name) values("Cafe Owner");
insert into profile (profile_name) values("Cafe Manager");
insert into profile (profile_name) values("Cafe Staff");

ALTER TABLE EMPLOYEE ADD COLUMN EMP_MAX_SLOTS INT;